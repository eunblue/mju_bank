<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëª…ì§€ì€í–‰ - ê³„ì¢Œ & ì¹´ë“œ ê´€ë¦¬</title>
    <style>
        /* í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • */
        body { 
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif; 
            max-width: 1000px; 
            margin: auto; 
            padding: 0; 
            background-color: #f4f7f6; /* ë°ì€ íšŒìƒ‰ ë°°ê²½ */
            color: #333;
        }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        #header {
            background-color: #004d99; /* ì§„í•œ íŒŒë€ìƒ‰ */
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            border-bottom: 5px solid #002c5f;
            margin-bottom: 30px;
        }

        #bankLogo {
            height: 40px;
            margin-right: 15px;
        }

        #bankName {
            font-size: 24px;
            font-weight: bold;
        }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        h2 { 
            color: #004d99; /* ì€í–‰ ë©”ì¸ ì»¬ëŸ¬ */
            border-left: 5px solid #004d99;
            padding-left: 10px;
            margin-bottom: 20px;
        }
        
        .section { 
            margin-bottom: 40px; 
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        hr {
            border: 0;
            border-top: 1px solid #ddd;
            margin: 30px 0;
        }

        /* í¼ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: bold; 
            color: #555;
            font-size: 14px;
        }
        
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin-top: 6px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            box-sizing: border-box; 
            font-size: 16px;
        }
        
        select { 
            width: calc(100% - 2px); 
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { 
            cursor: pointer; 
            background-color: #0099cc; /* ë°ì€ íŒŒë€ìƒ‰ */
            color: white; 
            border: none; 
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover { 
            background-color: #007399; 
        }

        /* ì¡°íšŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë¶„ë¦¬ */
        #searchName + button {
            background-color: #0099cc; 
            margin-left: 10px;
            width: auto;
            padding: 10px 15px;
        }

        #searchName + button:hover {
            background-color: #449d44;
        }


        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        
        th, td { 
            border: 1px solid #eee; 
            padding: 12px; 
            text-align: left; 
        }
        
        th { 
            background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ */
            color: #333;
            font-weight: normal;
        }
        
        /* ê²°ê³¼ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .success { 
            color: #28a745; 
            font-weight: bold; 
            margin-top: 15px;
            padding: 10px; 
            background-color: #e2f7e4; 
            border: 1px solid #28a745; 
            border-radius: 5px;
        }
        
        .error { 
            color: #dc3545; 
            font-weight: bold; 
            margin-top: 15px;
            padding: 10px; 
            background-color: #f9e2e5; 
            border: 1px solid #dc3545; 
            border-radius: 5px;
        }
        
        #birthdayResult {
            padding: 15px;
            background-color: #fffbe6;
            border: 1px solid #ffc107;
            border-radius: 5px;
            line-height: 1.6;
        }

        #searchName {
            width: 300px;
            display: inline-block;
        }
        #searchName + button {
            width: auto;
        }
    </style>
</head>
<body>

<div id="header">
    <img id="bankLogo" alt="ëª…ì§€ì€í–‰ ë¡œê³ ">
    <span id="bankName">ëª…ì§€ì€í–‰ - ê¸ˆìœµ ì„œë¹„ìŠ¤</span>
</div>

<div style="padding: 20px;">
    <div class="section">
        <h2>ìƒˆ ê³„ì¢Œ ë§Œë“¤ê¸° ğŸ¦</h2>
        <form id="accountForm">
            <label>ê³ ê° ì´ë¦„ :</label>
            <input type="text" id="customerName" required>

            <label>ê³ ê° ì£¼ë¯¼ë²ˆí˜¸(SSN) :</label>
            <input type="text" id="customerSsn" required>

            <label>ê³„ì¢Œ ì¢…ë¥˜ :</label>
            <select id="accountType">
                <option value="ì ê¸ˆ">ì ê¸ˆ</option>
                <option value="ì…ì¶œê¸ˆ">ì…ì¶œê¸ˆ</option>
            </select><br><br>

            <button type="button" onclick="submitAccountForm()">ê³„ì¢Œ ìƒì„±</button>
        </form>
        <div id="accountResult"></div>
    </div>

    <hr>

    <div class="section">
        <h2>ê³ ê° ê³„ì¢Œ ì¡°íšŒ ğŸ”</h2>
        <label>ê³ ê° ì´ë¦„:</label>
        <input type="text" id="searchName" placeholder="ì„±ëª…">
        <button onclick="fetchAccounts()">ì¡°íšŒ</button>
        <div id="accountsTable"></div>
    </div>

    <hr>

    <div class="section">
        <h2>ì¹´ë“œ ë°œê¸‰ ğŸ’³</h2>
        <form id="cardForm">
            <label>ê³ ê° SSN:</label>
            <input type="text" id="cardCustomerSsn" required>

            <label>ê³ ê° ì´ë¦„:</label>
            <input type="text" id="cardCustomerName" required>

            <label>ì—°ê²° ê³„ì¢Œ ID:</label>
            <input type="text" id="accountId" required>

            <label>ì¹´ë“œ ì¢…ë¥˜:</label>
            <select id="cardType">
                <option value="ì‹ ìš©">ì‹ ìš©ì¹´ë“œ</option>
                <option value="ì²´í¬">ì²´í¬ì¹´ë“œ</option>
            </select>

            <button type="button" onclick="issueCard()">ì¹´ë“œ ë°œê¸‰ ì‹ ì²­</button>
        </form>
        <div id="cardResult"></div>
    </div>
    <button id="btnNextBirthday">ê°€ì¥ ê°€ê¹Œìš´ ìƒì¼ ê³ ê° ì¡°íšŒ ğŸ‚</button>

    <div id="birthdayResult" style="margin-top:15px; font-size:18px; font-weight:bold;"></div>
</div>

<script>
// --- ë¡œê³  ì´ë¯¸ì§€ ì„¤ì • (JavaScript) ---
// ê°™ì€ ìœ„ì¹˜ í´ë”ì— ìˆëŠ” symbol02.pngë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
document.addEventListener('DOMContentLoaded', function() {
    const logoElement = document.getElementById('bankLogo');
    // ë¡œê³  íŒŒì¼ ê²½ë¡œ ì„¤ì •
    logoElement.src = 'symbol02.png'; 
});

function submitAccountForm() {
    const name = document.getElementById("customerName").value;
    const ssn = document.getElementById("customerSsn").value;
    const type = document.getElementById("accountType").value;

    fetch(`/account/create?customerSsn=${ssn}&customerName=${name}&accountType=${type}`, {
        method: "POST"
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("accountResult").innerHTML =
            `<div class="success">âœ… ê³„ì¢Œ ìƒì„± ì™„ë£Œ!</div>
             <p><strong>ê³„ì¢Œ ID:</strong> ${data.accountId}</p>
             <p><strong>ê³„ì¢Œ ì¢…ë¥˜:</strong> ${data.accountType}</p>
             <p><strong>ê³ ê° ì´ë¦„:</strong> ${data.customer.customerName}</p>
             <p><strong>ê³ ê° SSN:</strong> ${data.customer.customerSsn}</p>`;
    })
    .catch(err => { 
        document.getElementById("accountResult").innerHTML = `<div class="error">âŒ ì˜¤ë¥˜ ë°œìƒ: ${err.message || 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨'}</div>`;
    });
}

async function fetchAccounts() {
    const name = document.getElementById("searchName").value.trim();
    if (!name) return alert("ê³ ê° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");

    try {
        const res = await fetch(`/account/by-name/grouped?customerName=${encodeURIComponent(name)}`);
        if (!res.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
        const grouped = await res.json();

        let html = "";
        for (const ssn in grouped) {
            html += `<h3>ê³ ê° SSN: ${ssn} (${grouped[ssn][0].customerName})</h3>`;
            html += `<table>
                        <tr><th>ê³„ì¢Œ ID</th><th>ê³„ì¢Œ ì¢…ë¥˜</th><th>ì”ì•¡</th></tr>`;
            grouped[ssn].forEach(acc => {
                html += `<tr>
                            <td>${acc.accountId}</td>
                            <td>${acc.accountType}</td>
                            <td>${acc.balance.toLocaleString()}ì›</td>
                         </tr>`;
            });
            html += `</table><br>`;
        }
        document.getElementById("accountsTable").innerHTML = html;
    } catch(err) {
        document.getElementById("accountsTable").innerHTML = `<div class="error">ì˜¤ë¥˜: ${err.message}</div>`;
    }
}

function issueCard() {
    const formData = new URLSearchParams();
    formData.append("customerSsn", document.getElementById("cardCustomerSsn").value);
    formData.append("customerName", document.getElementById("cardCustomerName").value);
    formData.append("accountId", document.getElementById("accountId").value);
    formData.append("cardType", document.getElementById("cardType").value);

    fetch("/account/card/issue", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData.toString()
    })
    .then(res => res.json())
    .then(card => {
        document.getElementById("cardResult").innerHTML =
            `<div class="success">ì¹´ë“œ ë°œê¸‰ ì„±ê³µ!</div>
             <p>ì¹´ë“œ ID: ${card.cardId}</p>
             <p>ê³ ê° ì´ë¦„: ${card.customer.customerName}</p>
             <p>ê³ ê° SSN: ${card.customer.customerSsn}</p>
             <p>ì—°ê²° ê³„ì¢Œ ID: ${card.account.accountId}</p>
             <p>ì¹´ë“œ ì¢…ë¥˜: ${card.cardType}</p>
             <p>ë°œê¸‰ì¼: ${card.issueDate}</p>`;
    })
    .catch(err => {
        document.getElementById("cardResult").innerHTML = `<div class="error">${err}</div>`;
    });
}

 document.getElementById("btnNextBirthday").addEventListener("click", function() {
        fetch("/account/next-birthday")
            .then(response => response.json())
            .then(data => {
                let resultArea = document.getElementById("birthdayResult");

                if(!data || !data.customerName) {
                    resultArea.innerHTML = "ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";
                    return;
                }

                resultArea.innerHTML =
                    `ğŸ‰ <b>${data.customerName}</b> ê³ ê°ë‹˜ì˜ ìƒì¼ì´ ê°€ì¥ ê°€ê¹Œì›Œìš”! <br>
                     ğŸ“ ì£¼ì†Œ: ${data.address} <br>
                     ğŸ‚ ìƒì¼: ${data.birthDate} <br>
                     â³ D-Day: <b>${data.dday}ì¼ ë‚¨ìŒ</b>`;
            })
            .catch(err => console.error(err));
    });
</script>
</body>
</html>
